<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾¿ç•¶è¦çŒ›</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <header>
        <h1>ä¾¿ç•¶å·¥å» ğŸ’ª</h1>
        <ul>
            <li><a href="#">æœ€æ–°æ¶ˆæ¯</a></li>
            <li><a href="#">é—œæ–¼æˆ‘å€‘</a></li>
            <li><a href="#">é–€å¸‚æ“šé»</a></li>
            <li><a href="#">æœƒå“¡å°ˆå€</a></li>
        </ul>
    </header>

    <main>
        <section class="shop">
            <img src="image/åº—.png" alt="ä¾¿ç•¶å·¥å» å¤§å°ä¸­åº—">
            <img src="image/åº—2.png" alt="ä¾¿ç•¶å·¥å» å¤§å°ä¸­åº—">
        </section>
        <section class="info">
                <h2>12/23å¤§å°ä¸­åº—éš†é‡é–‹å¹•!</h2>
                <p>æ˜äº®é€šé€çš„ç©ºé–“è¨­è¨ˆï¼Œæ­é…ç¶ æ„ç›ç„¶çš„æ¤æ ½é»ç¶´ï¼Œç‡Ÿé€ å‡ºå¯§éœèˆ’é©çš„ç”¨é¤æ°›åœ,<br>
                ç«‹å³é è¨‚ï¼Œé–‹å•Ÿæ‚¨çš„å¥åº·ç¾å‘³ä¹‹æ—…ï¼</p>
        </section>
        <section class="product">
            <div>
                <img src="image/é›èƒ¸.jpg" alt="é®®å«©é›èƒ¸">
                <h3>åœ‹ç”¢é›èƒ¸ä¾¿ç•¶</h3>
                <p>ä½è„‚é«˜è›‹ç™½çš„å®Œç¾é¸æ“‡ã€‚ä»¥èˆ’è‚¥å·¥æ³•é–ä½æ°´åˆ†ï¼Œå£æ„Ÿæ»‘å«©ï¼Œå¥èº«æ¸›è„‚å¿…å‚™ã€‚<br><strong>150NT</strong></p>
                <button class="order" data-item="åœ‹ç”¢é›èƒ¸ä¾¿ç•¶" data-price="150">åŠ å…¥è¨‚å–®</button>
            </div>
            <div>
                <img src="image/è±¬è‚‰.png" alt="è±¬è‚‰">
                <h3>ç‚™ç‡’èˆ’è‚¥é‡Œè‚Œä¾¿ç•¶</h3>
                <p>é¸ç”¨ä½è„‚é‡Œè‚Œéƒ¨ä½ï¼Œå£æ„ŸQå½ˆè„†å«©ã€‚ä½æº«çƒ¹èª¿å¾Œç‚™ç‡’ï¼Œç¾å‘³èˆ‡å¥åº·å…¼å¾—ã€‚<br><strong>200NT</strong></p>
                <button class="order" data-item="ç‚™ç‡’èˆ’è‚¥é‡Œè‚Œä¾¿ç•¶" data-price="200">åŠ å…¥è¨‚å–®</button>
            </div>

            <div>
                <img src="image/ç‰›æ’.jpg" alt="è‚‹çœ¼ç‰›æ’">
                <h3>æ¾³æ´²è‚‹çœ¼ç‰›æ’ä¾¿ç•¶</h3>
                <p>åš´é¸å„ªè³ªè‚‹çœ¼éƒ¨ä½ï¼Œæ­é…ç¨å®¶èª¿å‘³ã€‚è£œå……éµè³ªèˆ‡èƒºåŸºé…¸ï¼Œå£æ„Ÿè±å¯Œï¼Œæ´»åŠ›åŠ å€ã€‚<br><strong>220NT</strong></p>
                <button class="order" data-item="æ¾³æ´²è‚‹çœ¼ç‰›æ’ä¾¿ç•¶" data-price="220">åŠ å…¥è¨‚å–®</button>
            </div>

            <div>
                <img src="image/é®­é­š.jpg" alt="é®­é­š">
                <h3>å†°å³¶é®­é­šè²åŠ›ä¾¿ç•¶</h3>
                <p>ç°¡å–®é¦™çƒ¤ï¼Œé®®ç”œå¤šæ±ã€‚å¯Œå«Omega-3ä¸é£½å’Œè„‚è‚ªé…¸ï¼Œå°å¿ƒè¡€ç®¡åŠå¤§è…¦å¥åº·æ¥µæœ‰ç›Šè™•ã€‚<br><strong>250NT</strong></p>
                <button class="order" data-item="å†°å³¶é®­é­šè²åŠ›ä¾¿ç•¶" data-price="250">åŠ å…¥è¨‚å–®</button>
            </div>
            
        </section>
        <section class="news">
            <h2>å¥åº·ä¾¿ç•¶é™æ™‚ä¾›æ‡‰</h2>
            <p><strong>åš´é¸æ–°é®®é£Ÿæå’Œæ¥µè‡´åŒ äººç²¾ç¥</strong></p>
            <p><em><a href="#">äº†è§£æ›´å¤š</a></em></p>
        </section>
        <div id="cart-container">
            <h2>ğŸ›’ æˆ‘çš„è¨‚å–®</h2>
            <ul id="cart-items">
                <li>æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„ã€‚</li>
            </ul>
            <p>ç¸½é‡‘é¡ï¼š<span id="cart-total">0</span> NT</p>
            <div class="cart-actions">
                <button id="checkout-btn">å‰å¾€çµå¸³</button>
                <button id="clear-cart-btn" class="clear-btn">æ¸…ç©º</button>
            </div>
        </div>

        <div id="checkout-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>ğŸ“ çµå¸³ç¢ºèª</h2>
                
                <div class="form-group">
                    <label>è¨‚å–®æ˜ç´°ï¼š</label>
                    <ul id="modal-cart-list" class="order-summary-list">
                        </ul>
                    <p style="text-align: right; font-weight: bold; color: #d56838;">
                        æ‡‰ä»˜é‡‘é¡ï¼š<span id="modal-total-price">0</span> NT
                    </p>
                </div>

                <form id="checkout-form">
                    <div class="form-group">
                        <label for="customer-name">è¨‚è³¼äººå§“åï¼š</label>
                        <input type="text" id="customer-name" placeholder="è«‹è¼¸å…¥å§“å" required>
                    </div>

                    <div class="form-group">
                        <label for="customer-phone">è¯çµ¡é›»è©±ï¼š</label>
                        <input type="tel" id="customer-phone" placeholder="09xx-xxx-xxx" required>
                    </div>

                    <div class="form-group">
                        <label for="payment-method">ä»˜æ¬¾æ–¹å¼ï¼š</label>
                        <select id="payment-method" required>
                            <option value="" disabled selected>è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼</option>
                            <option value="cash">ğŸ’° è²¨åˆ°ä»˜æ¬¾ (ç¾é‡‘)</option>
                            <option value="line_pay">ğŸ“± Line Pay</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pickup-method">å–é¤æ–¹å¼ï¼š</label>
                        <select id="pickup-method">
                            <option value="store">é–€å¸‚è‡ªå–</option>
                        </select>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn-confirm">ç¢ºèªä¸‹å–®</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            
            // =========================================================
            // I. æ ¸å¿ƒæ•¸æ“šé¡åˆ¥ (Data Model)
            // =========================================================

            /**
             * Cart é¡åˆ¥: å°ˆæ³¨æ–¼ç®¡ç†å•†å“åˆ—è¡¨å’Œç¸½é‡‘é¡è¨ˆç®—ã€‚
             * æ¦‚å¿µ: å°è£ (Encapsulation) - å°‡æ•¸æ“š (this.items) èˆ‡æ“ä½œ (addItem, getTotal) ç¶å®šã€‚
             */
            class Cart {
                constructor() {
                    this.items = []; 
                }

                // æ–¹æ³•: è¨ˆç®—ç¸½é‡‘é¡
                getTotal() {
                    return this.items.reduce((total, item) => total + (item.price * item.quantity), 0);
                }

                // æ–¹æ³•: æ·»åŠ å•†å“
                addItem(name, price) {
                    const existingItem = this.items.find(item => item.name === name);

                    if (existingItem) {
                        existingItem.quantity += 1; 
                    } else {
                        this.items.push({ name: name, price: price, quantity: 1 }); 
                    }
                    return true;
                }

                // æ–¹æ³•: æ¸…ç©ºè³¼ç‰©è»Š
                clear() {
                    this.items = [];
                }

                // æ–¹æ³•: å–å¾—è¨‚å–®æ‘˜è¦
                getSummary() {
                    return this.items.map(item => ({
                        name: item.name,
                        quantity: item.quantity,
                        subtotal: item.price * item.quantity
                    }));
                }
            }

            // =========================================================
            // II. ç¹¼æ‰¿èˆ‡å¤šå‹ (Polymorphism & Inheritance)
            // =========================================================

            /**
             * BasePaymentHandler é¡åˆ¥: ä½œç‚ºæ‰€æœ‰ä»˜æ¬¾æ–¹å¼çš„æŠ½è±¡åŸºç¤ã€‚
             * æ¦‚å¿µ: æŠ½è±¡åŒ– (Abstraction) - å®šç¾©äº† `checkout` æµç¨‹ï¼Œä½†å°‡ç´°ç¯€ (processPayment) ç•™çµ¦å­é¡å¯¦ä½œã€‚
             */
            class BasePaymentHandler {
                constructor(cart) {
                    this.cart = cart;
                }

                // æŠ½è±¡æ–¹æ³•: è™•ç†æ”¯ä»˜ï¼Œå­é¡å¿…é ˆå¯¦ç¾ (å¯¦ç¾å¤šå‹)
                processPayment(orderData) {
                    throw new Error("å­é¡å¿…é ˆå¯¦ç¾ processPayment æ–¹æ³•");
                }

                // é€šç”¨æ–¹æ³•: åŸ·è¡Œçµå¸³
                checkout(orderData) {
                    if (this.cart.getTotal() === 0) {
                        alert('è³¼ç‰©è»Šç‚ºç©ºï¼Œç„¡æ³•çµå¸³ã€‚');
                        return false;
                    }
                    this.processPayment(orderData); // å¤šå‹: æ ¹æ“šå¯¦ä¾‹åŒ–é¡å‹åŸ·è¡Œä¸åŒçš„æ”¯ä»˜é‚è¼¯
                    this.cart.clear(); 
                    return true;
                }
            }

            /**
             * CashPaymentHandler é¡åˆ¥: ç¾é‡‘ä»˜æ¬¾è™•ç†ã€‚
             * æ¦‚å¿µ: ç¹¼æ‰¿ (Inheritance) - ç¹¼æ‰¿äº† BasePaymentHandler çš„ checkout æµç¨‹ã€‚
             */
            class CashPaymentHandler extends BasePaymentHandler {
                processPayment(orderData) {
                    const finalPrice = this.cart.getTotal();
                    alert(`âœ… è¨‚å–®å·²æˆç«‹ï¼\n\næ„Ÿè¬ ${orderData.name} çš„è¨‚è³¼ã€‚\nä»˜æ¬¾æ–¹å¼ï¼š${orderData.paymentMethod}\nç¸½é‡‘é¡ï¼š${finalPrice} NT\n\nè«‹æº–å‚™ç¾é‡‘æ–¼å–é¤æ™‚ä»˜æ¬¾ï¼`);
                }
            }

            /**
             * LinePayHandler é¡åˆ¥: Line Pay è™•ç†ã€‚
             * æ¦‚å¿µ: å¤šå‹ (Polymorphism) - èˆ‡ CashPaymentHandler å…·æœ‰ç›¸åŒçš„ processPayment ä»‹é¢ï¼Œä½†å…§éƒ¨è¡Œç‚ºä¸åŒã€‚
             */
            class LinePayHandler extends BasePaymentHandler {
                processPayment(orderData) {
                    const finalPrice = this.cart.getTotal();
                    alert(`âœ… è¨‚å–®å·²æˆç«‹ï¼\n\næ„Ÿè¬ ${orderData.name} çš„è¨‚è³¼ã€‚\nä»˜æ¬¾æ–¹å¼ï¼š${orderData.paymentMethod}\nç¸½é‡‘é¡ï¼š${finalPrice} NT\n\næ­£åœ¨æ¨¡æ“¬è·³è½‰è‡³ Line Pay ä»˜æ¬¾é é¢...`);
                }
            }

            // =========================================================
            // III. è¦–åœ–/æ§åˆ¶å™¨é¡åˆ¥ (View/Controller)
            // =========================================================

            /**
             * CartView é¡åˆ¥: å°ˆæ³¨æ–¼å°‡ Cart æ•¸æ“šæ¸²æŸ“åˆ° DOM ä»‹é¢ã€‚
             * æ¦‚å¿µ: è·è²¬åˆ†é›¢ (Separation of Concerns) - å°‡æ•¸æ“šæ“ä½œ (Cart) èˆ‡ä»‹é¢æ“ä½œ (CartView) åˆ†é–‹ã€‚
             */
            class CartView {
                constructor(cart, cartElementId, totalElementId, modalListId, modalTotalId) {
                    this.cart = cart;
                    this.cartItemsElement = document.getElementById(cartElementId);
                    this.cartTotalElement = document.getElementById(totalElementId);
                    this.modalCartList = document.getElementById(modalListId);
                    this.modalTotalPrice = document.getElementById(modalTotalId);
                }

                // æ–¹æ³•: æ¸²æŸ“è³¼ç‰©è»Šå´é‚Šæ¬„
                renderSidebar() {
                    this.cartItemsElement.innerHTML = ''; 
                    const total = this.cart.getTotal();
                    const items = this.cart.getSummary();

                    if (items.length === 0) {
                        this.cartItemsElement.innerHTML = '<li>æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„ã€‚</li>';
                    } else {
                        items.forEach(item => {
                            const li = document.createElement('li');
                            li.innerHTML = `${item.name} (x${item.quantity}) <span>${item.subtotal} NT</span>`;
                            this.cartItemsElement.appendChild(li);
                        });
                    }
                    this.cartTotalElement.textContent = total; 
                }

                // æ–¹æ³•: æ¸²æŸ“çµå¸³å½ˆçª—å…§å®¹
                renderModal() {
                    this.modalCartList.innerHTML = '';
                    const total = this.cart.getTotal();
                    const items = this.cart.getSummary();

                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `<span>${item.name} x ${item.quantity}</span> <span>${item.subtotal} NT</span>`;
                        this.modalCartList.appendChild(li);
                    });
                    this.modalTotalPrice.textContent = total;
                }

                // åˆå§‹åŒ–æ™‚æ¸²æŸ“
                init() {
                    this.renderSidebar();
                }
            }

            /**
             * App é¡åˆ¥: æ‡‰ç”¨ç¨‹å¼çš„ä¸»æ§åˆ¶å™¨ï¼Œè² è²¬åˆå§‹åŒ–å’Œå”èª¿æ‰€æœ‰å…ƒä»¶ã€‚
             * æ¦‚å¿µ: å”èª¿å™¨ (Coordinator) / é–€é¢æ¨¡å¼ (Facade Pattern) - ä½œç‚ºå–®ä¸€å…¥å£ï¼Œè² è²¬çµ„è£å’Œç®¡ç†å…¶ä»–é¡åˆ¥çš„å¯¦ä¾‹ã€‚
             */
            class App {
                constructor() {
                    // å¯¦ä¾‹åŒ–æ ¸å¿ƒæ•¸æ“šæ¨¡å‹
                    this.cart = new Cart(); // æ¦‚å¿µ: å¯¦ä¾‹åŒ– (Instantiation)

                    // å¯¦ä¾‹åŒ–è¦–åœ–å…ƒä»¶
                    this.view = new CartView(
                        this.cart,
                        'cart-items',
                        'cart-total',
                        'modal-cart-list',
                        'modal-total-price'
                    );

                    // å¯¦ä¾‹åŒ– DOM å…ƒç´  (ä½œç‚ºå…§éƒ¨å±¬æ€§)
                    this.orderButtons = document.querySelectorAll('.order');
                    this.checkoutButton = document.getElementById('checkout-btn');
                    this.clearCartButton = document.getElementById('clear-cart-btn');
                    this.modal = document.getElementById("checkout-modal");
                    this.closeModalSpan = document.getElementsByClassName("close")[0];
                    this.checkoutForm = document.getElementById("checkout-form");
                }

                // æ–¹æ³•: ç¶å®šæ‰€æœ‰äº‹ä»¶
                bindEvents() {
                    // ä½¿ç”¨ .bind(this) ç¢ºä¿äº‹ä»¶è™•ç†å™¨ä¸­çš„ this æŒ‡å‘ App å¯¦ä¾‹
                    this.orderButtons.forEach(button => {
                        button.addEventListener('click', this.handleAddItem.bind(this));
                    });

                    this.clearCartButton.addEventListener('click', this.handleClearCart.bind(this));
                    this.checkoutButton.addEventListener('click', this.handleOpenModal.bind(this));
                    this.closeModalSpan.onclick = this.handleCloseModal.bind(this);
                    window.onclick = (event) => {
                        if (event.target == this.modal) {
                            this.handleCloseModal();
                        }
                    };
                    this.checkoutForm.addEventListener('submit', this.handleCheckout.bind(this));
                }

                // äº‹ä»¶è™•ç†æ–¹æ³•: çµå¸³
                handleCheckout(e) {
                    e.preventDefault(); 
                    
                    // å¾ DOM å–å¾—è¡¨å–®æ•¸æ“š
                    const name = document.getElementById('customer-name').value;
                    const paymentElement = document.getElementById('payment-method');
                    const paymentValue = paymentElement.value;
                    const paymentText = paymentElement.options[paymentElement.selectedIndex].text;

                    const orderData = {
                        name: name,
                        paymentMethod: paymentText
                    };
                    
                    let paymentHandler;

                    // æ ¹æ“šé¸æ“‡çš„ä»˜æ¬¾æ–¹å¼ï¼Œå¯¦ä¾‹åŒ–å°æ‡‰çš„è™•ç†å™¨ (å¤šå‹å¯¦è¸)
                    if (paymentValue === 'cash') {
                        paymentHandler = new CashPaymentHandler(this.cart);
                    } else if (paymentValue === 'line_pay') {
                        paymentHandler = new LinePayHandler(this.cart);
                    } else {
                        alert('è«‹é¸æ“‡æœ‰æ•ˆçš„ä»˜æ¬¾æ–¹å¼ã€‚');
                        return;
                    }

                    // åŸ·è¡Œçµå¸³æµç¨‹
                    if (paymentHandler.checkout(orderData)) {
                        this.view.renderSidebar(); 
                        this.checkoutForm.reset(); 
                        this.handleCloseModal();
                    }
                }

                // å…¶ä»–äº‹ä»¶è™•ç†å™¨ (handleAddItem, handleClearCart, handleOpenModal, handleCloseModal...) 
                // é‚è¼¯èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒï¼Œè² è²¬å‘¼å« Cart å’Œ View çš„æ–¹æ³•ã€‚
                handleAddItem(event) {
                    const button = event.currentTarget;
                    const itemName = button.getAttribute('data-item');
                    const itemPrice = parseInt(button.getAttribute('data-price'));
                    
                    this.cart.addItem(itemName, itemPrice);
                    alert(`å·²å°‡ã€${itemName}ã€‘åŠ å…¥è¨‚å–®ï¼`);
                    this.view.renderSidebar();
                }

                handleClearCart() {
                    if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ•´å€‹è³¼ç‰©è»Šå—ï¼Ÿ')) {
                        this.cart.clear();
                        this.view.renderSidebar();
                    }
                }

                handleOpenModal() {
                    if (this.cart.getTotal() === 0) {
                        alert('è«‹å…ˆåŠ å…¥å•†å“æ‰èƒ½çµå¸³å–”ï¼');
                        return;
                    }
                    this.view.renderModal();
                    this.modal.style.display = "flex";
                }

                handleCloseModal() {
                    this.modal.style.display = "none";
                }

                // æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å…¥å£
                init() {
                    this.view.init(); 
                    this.bindEvents(); 
                }
            }

            // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ (å–®ä¸€æ§åˆ¶é»)
            const bentoApp = new App();
            bentoApp.init();
        
        </script>
    </main>
    <footer>
        <p>Copyright @ 2025 ä¾¿ç•¶å·¥å»  ALL RIGHTS RESERVED.</p>
    </footer>
</body>
</html>
